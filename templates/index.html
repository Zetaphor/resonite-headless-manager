<!DOCTYPE html>
<html>

<head>
  <title>Docker Container Console</title>
  <style>
    #output {
      width: 100%;
      height: 400px;
      background-color: #1e1e1e;
      color: #ffffff;
      font-family: monospace;
      padding: 10px;
      overflow-y: auto;
      margin-bottom: 10px;
    }

    #command-input {
      width: 80%;
      padding: 5px;
    }

    #status {
      margin-bottom: 10px;
      padding: 10px;
      background-color: #f0f0f0;
    }

    .command-line {
      color: #00ff00;
    }

    .error {
      color: #ff0000;
    }
  </style>
</head>

<body>
  <div id="status">Status: Connecting...</div>
  <div id="output"></div>
  <input type="text" id="command-input" placeholder="Enter command...">
  <button onclick="sendCommand()">Send</button>

  <script>
    let ws;
    const output = document.getElementById('output');
    const commandInput = document.getElementById('command-input');
    const statusDiv = document.getElementById('status');

    function connect() {
      ws = new WebSocket(`ws://${window.location.host}/ws`);

      ws.onopen = function () {
        statusDiv.textContent = 'Status: Connected';
        // Request initial status
        ws.send(JSON.stringify({ type: 'get_status' }));
      };

      ws.onclose = function () {
        statusDiv.textContent = 'Status: Disconnected - Reconnecting...';
        setTimeout(connect, 1000);
      };

      ws.onmessage = function (event) {
        const data = JSON.parse(event.data);

        switch (data.type) {
          case 'container_output':
            appendOutput(data.output);
            break;
          case 'command_response':
            appendOutput(`> ${data.output}`, 'command-line');
            break;
          case 'status_update':
            updateStatus(data.status);
            break;
          case 'error':
            appendOutput(`Error: ${data.message}`, 'error');
            break;
        }
      };
    }

    function sendCommand() {
      const command = commandInput.value.trim();
      if (command) {
        ws.send(JSON.stringify({
          type: 'command',
          command: command
        }));
        appendOutput(`$ ${command}`, 'command-line');
        commandInput.value = '';
      }
    }

    function appendOutput(text, className = '') {
      const div = document.createElement('div');
      div.textContent = text;
      if (className) {
        div.className = className;
      }
      output.appendChild(div);
      output.scrollTop = output.scrollHeight;
    }

    function updateStatus(status) {
      if (status.error) {
        statusDiv.textContent = `Status: Error - ${status.error}`;
        return;
      }
      statusDiv.textContent = `Status: ${status.status} (${status.name})`;
    }

    // Handle Enter key in input
    commandInput.addEventListener('keypress', function (e) {
      if (e.key === 'Enter') {
        sendCommand();
      }
    });

    // Initial connection
    connect();
  </script>
</body>

</html>